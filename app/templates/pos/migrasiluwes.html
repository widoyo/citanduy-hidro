{% extends 'base.html' %}

{% block extra_head %}
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; position: sticky; top: 0; }
        .checkmark { 
            color: green !important; 
            font-weight: bold !important; 
            text-align: center !important; 
            font-size: 24px !important;
            padding: 15px !important;
        }
        .dash { 
            color: red !important; 
            font-weight: bold !important; 
            text-align: center !important; 
            font-size: 20px !important;
            padding: 15px !important;
        }
        .json-data { 
            max-width: 400px; 
            white-space: pre-wrap; 
            word-break: break-all;
            font-family: monospace;
            font-size: 12px !important;
        }
        .hidden { display: none; }
        .toggle-btn { 
            margin: 10px 0; 
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .toggle-btn:hover { background: #0056b3; }
        .button-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
{% endblock %}

{% block content %}
<h2>Migration Status</h2>
<div class="button-container">
    <p>Pembacaan: {{ reading_time }}</p>
    <button class="toggle-btn" onclick="toggleDataColumns()">Show Data Details</button>
</div>
    <table class="table table-striped table-hover table-bordered" id="migrationTable">
        <thead>
            <tr>
                <th>Imei</th>
                <th>Nama</th>
                <th>Data4</th>
                <th>Data3</th>
            </tr>
        </thead>
        <tbody>
            {% for row in data_lines %}
            <tr>
                <td>{{ row[0] }}</td>
                <td>{{ row[1] }}</td>
                <td class="json-data">{{ row[2] }}</td>
                <td class="json-data">{{ row[3] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block js_foot %}
   <script>
        let showDetails = true; // Start with hidden details

        function toggleDataColumns() {
            const table = document.getElementById('migrationTable');
            const button = document.querySelector('.toggle-btn');
            const rows = table.querySelectorAll('tbody tr');
            
            showDetails = !showDetails;
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                // Data4 is cells[2], Data3 is cells[3]
                const data4Cell = cells[2];
                const data3Cell = cells[3];
                
                if (showDetails) {
                    // Show original content
                    data4Cell.innerHTML = data4Cell.getAttribute('data-original') || data4Cell.innerHTML;
                    data3Cell.innerHTML = data3Cell.getAttribute('data-original') || data3Cell.innerHTML;
                    data4Cell.classList.remove('checkmark', 'dash');
                    data3Cell.classList.remove('checkmark', 'dash');
                    // Add back json-data class and styling
                    data4Cell.classList.add('json-data');
                    data3Cell.classList.add('json-data');
                    // Remove Bootstrap table cell styling override
                    data4Cell.style.cssText = '';
                    data3Cell.style.cssText = '';
                    button.textContent = 'Hide Data Details';
                } else {
                    // Store original content and show checkmarks/dashes
                    if (!data4Cell.hasAttribute('data-original')) {
                        data4Cell.setAttribute('data-original', data4Cell.innerHTML);
                    }
                    if (!data3Cell.hasAttribute('data-original')) {
                        data3Cell.setAttribute('data-original', data3Cell.innerHTML);
                    }
                    
                    // Determine if we should show checkmark or dash
                    const hasData4 = data4Cell.getAttribute('data-original') !== '-';
                    const hasData3 = data3Cell.getAttribute('data-original') !== '-';
                    
                    data4Cell.innerHTML = hasData4 ? '✓' : '-';
                    data3Cell.innerHTML = hasData3 ? '✓' : '-';
                    
                    // Apply appropriate class and remove json-data class
                    data4Cell.className = hasData4 ? 'checkmark' : 'dash';
                    data3Cell.className = hasData3 ? 'checkmark' : 'dash';
                    
                    // Force override Bootstrap styles
                    data4Cell.style.cssText = 'text-align: center !important; font-size: ' + (hasData4 ? '24px' : '20px') + ' !important; padding: 15px !important;';
                    data3Cell.style.cssText = 'text-align: center !important; font-size: ' + (hasData3 ? '24px' : '20px') + ' !important; padding: 15px !important;';
                    button.textContent = 'Show Data Details';
                }
            });
        }

        // Initialize the table with details hidden (checkmarks/dashes shown)
        document.addEventListener('DOMContentLoaded', function() {
            toggleDataColumns(); // This will set the initial state to hidden details
        });
    </script>
{% endblock %}