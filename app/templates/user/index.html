{% extends 'base.html' %}
{% block content %}
        <h2 class="border-start border-5 border-danger ps-2 fw-lighter">User (<b>{{ users|length}}</b>)
            <a href="#userform" data-bs-toggle="collapse" class="ms-5 btn btn-outline-primary btn-sm">tambah</a>
        </h2>
        {% for message in get_flashed_messages() %}
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}

        <form class="collapse px-5 py-5" id="userform" action="/user/add" method="POST">
            {{ form.hidden_tag() }}
            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                {{ form.username(class="form-control") }}
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                {{ form.password(class="form-control") }}
                <div class="form-text">Bisa diganti nanti</div>
            </div>
            <div class="mb-3">
                {{ form.pos(class="form-select") }}
            </div>
            
<input type="submit" class="btn btn-primary">
        </form>
        
<div class="row">
    <div class="col-sm-10">
        <table class="table table-bordered table-hover table-striped">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Pos</th>
                    <th>Login Terakhir</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td x-data="setPassword('{{ u.username }}')">{{ u.username }} 
                        <span @click.stop="open()" class="float-end"><i class="bi bi-key"></i></span>
                        <div x-html="pwForm"></div>
                    </td>
                    <td>{% if not u.is_admin %}{{ u.pos.nama }}{% else %}Kantor{% endif %}</td>
                    <td>{% if u.last_login %}{{ u.last_login.strftime('%d %b %Y %H:%M:%S') }}{% endif %}</td>
                    
                </tr>
                {% else %}
                <tr>
                    <td colspan="3">Belum ada User terdaftar</td>
                </tr>
                {% endfor %}        
            </tbody>
        </table>
    </div>
    <div class="col-sm-2">

    </div>
</div>
<script>
    function setPassword(uname) {
        return {
            pwForm: '',
            pwd: '',
            open() { 
                console.log(uname);
                this.pwForm = `<form class='float-end' method='POST' action='/user/`+uname+`/update'><input type='hidden' name='username' value='`+uname
                +`'><input x-model='pwd' @keyup='count()' type='text' name='password' autofocus> <input disabled @click.outside='closeF()' type='submit'></form>`
            },
            closeF() {
                this.pwForm = '';
            },
            count() {
                
                console.log(this.pwd.length);
            }

        }
    }
</script>
{% endblock %}